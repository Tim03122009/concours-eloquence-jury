<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Application de notation pour concours d'Ã©loquence - Interface jury">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>ðŸŽ­ Notation Concours Ã‰loquence</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="identification-page" class="page">
        <div class="burger-menu">
            <div class="burger-icon" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="burger-menu-content" id="menu-content">
                <div class="theme-toggle">
                    <span>Mode sombre</span>
                    <div class="toggle-switch" id="theme-toggle" onclick="toggleTheme()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <h2>Identification Jury</h2>
        <p id="active-round-display" style="text-align: center; font-size: 1.1em; color: var(--primary-color); margin: 10px 0 20px 0; font-weight: 600;">Chargement...</p>
        <div class="control-group">
            <label for="jury-name-input">Votre Nom / Identifiant :</label>
            <input type="text" id="jury-name-input" placeholder="Ex: Mme. Dupont" autocomplete="name" required>
        </div>
        <div class="control-group">
            <label for="password-input">Mot de passe (Optionnel) :</label>
            <input type="password" id="password-input" placeholder="Entrez votre mot de passe" autocomplete="current-password">
        </div>
        <button id="start-scoring-button">Commencer</button>
    </div>

    <div id="scoring-page" class="page">
        <div class="burger-menu">
            <div class="burger-icon" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="burger-menu-content" id="menu-content-scoring">
                <div class="theme-toggle">
                    <span>Mode sombre</span>
                    <div class="toggle-switch" id="theme-toggle-scoring" onclick="toggleTheme()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="menu-item" onclick="refreshCandidateList()">
                    <span>ðŸ”„ RafraÃ®chir la liste</span>
                </div>
                <div class="menu-item" onclick="changePassword()">
                    <span>ðŸ”‘ Changer le mot de passe</span>
                </div>
                <div class="menu-item" id="logout-button">
                    <span>DÃ©connexion</span>
                </div>
            </div>
        </div>
        
        <div>
            <h2 style="margin: 0;">Jury : <span id="current-jury-display"></span></h2>
            <p id="scoring-round-display" style="text-align: center; font-size: 1em; color: var(--primary-color); margin: 5px 0; font-weight: 500;">Chargement du tour...</p>
        </div>

        <div class="control-group">
            <label>1. Candidat Ã  noter :</label>
            <select id="candidate-select">
                <option value="" disabled selected>-- Charger la liste --</option>
            </select>
            <p id="selected-candidate-display" class="selection-info">Aucun candidat sÃ©lectionnÃ©</p>
        </div>

        <hr>

        <div class="control-group">
            <label>2. Fond / Argumentation (Coefficient Ã—3)</label>
            <div class="score-grid" id="grid-fond"></div>
            <p id="display-score-1" class="selection-info">Note Fond : -</p>
        </div>

        <hr>

        <div class="control-group">
            <label>3. Forme / Ã‰loquence (Coefficient Ã—1)</label>
            <div class="score-grid" id="grid-forme"></div>
            <p id="display-score-2" class="selection-info">Note Forme : -</p>
        </div>

        <button id="validate-button" disabled>Valider la notation</button>
    </div>

    <div id="confirmation-modal" class="modal">
        <div class="modal-content">
            <h3>Confirmer l'envoi ?</h3>
            <p>Candidat : <strong id="modal-candidate"></strong></p>
            <p>Fond : <strong id="modal-s1"></strong></p>
            <p>Forme : <strong id="modal-s2"></strong></p>
            <div>
                <button id="confirm-send-button">Confirmer</button>
                <button id="cancel-send-button">Annuler</button>
            </div>
        </div>
    </div>

    <script>
        // Theme Toggle Logic - Propre Ã  chaque membre du jury
        function getThemeKey() {
            // Utiliser le nom du jury pour une clÃ© unique de thÃ¨me
            const juryName = localStorage.getItem('currentJuryName');
            return juryName ? `theme_${juryName}` : 'theme_default';
        }
        
        function initTheme() {
            const themeKey = getThemeKey();
            const savedTheme = localStorage.getItem(themeKey) || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            // Update all theme toggles on page
            const toggles = ['theme-toggle', 'theme-toggle-scoring'];
            toggles.forEach(id => {
                const toggle = document.getElementById(id);
                if (toggle) {
                    if (savedTheme === 'dark') {
                        toggle.classList.add('active');
                    } else {
                        toggle.classList.remove('active');
                    }
                }
            });
        }

        async function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            
            // Sauvegarder avec une clÃ© spÃ©cifique au jury
            const themeKey = getThemeKey();
            localStorage.setItem(themeKey, newTheme);
            
            // Sauvegarder aussi dans Firebase si connectÃ©
            const juryName = localStorage.getItem('currentJuryName');
            if (juryName && juryName !== 'admin') {
                try {
                    const { doc, updateDoc, getFirestore } = await import('https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js');
                    const { db } = await import('./firebase-init.js');
                    
                    await updateDoc(doc(db, "accounts", juryName), {
                        theme: newTheme
                    });
                } catch (e) {
                    console.log('Impossible de sauvegarder le thÃ¨me dans Firebase:', e);
                }
            }
            
            // Update all theme toggles on page
            const toggles = ['theme-toggle', 'theme-toggle-scoring'];
            toggles.forEach(id => {
                const toggle = document.getElementById(id);
                if (toggle) {
                    if (newTheme === 'dark') {
                        toggle.classList.add('active');
                    } else {
                        toggle.classList.remove('active');
                    }
                }
            });
        }

        function toggleMenu() {
            const menus = ['menu-content', 'menu-content-scoring'];
            menus.forEach(id => {
                const menu = document.getElementById(id);
                if (menu) {
                    menu.classList.toggle('active');
                }
            });
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menus = document.querySelectorAll('.burger-menu-content');
            const burgerIcon = event.target.closest('.burger-icon');
            
            if (!burgerIcon) {
                menus.forEach(menu => {
                    if (!menu.contains(event.target)) {
                        menu.classList.remove('active');
                    }
                });
            }
        });

        // Initialize theme on page load
        initTheme();
    </script>
    <script>window.useCustomModals = true;</script>
    <script src="modal.js"></script>
    <script type="module" src="script.js"></script>
</body>
</html>